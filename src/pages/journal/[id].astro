---
import { render } from "astro:content";
import type { ComponentProps } from "astro/types";
import ContentProperties from "@/components/atoms/content-properties.astro";
import Separator from "@/components/atoms/separator.astro";
import Template from "@/components/layouts/template.astro";
import { type EntryWithDates, getCollectionWithDates } from "@/helpers/time";

export async function getStaticPaths() {
  return (await getCollectionWithDates("journals")).map((entry) => ({
    params: { id: entry.id },
    props: { entry },
  }));
}

interface Props {
  entry: EntryWithDates<"journals">;
}

const { entry } = Astro.props;
const { Content } = await render(entry);

const metadata: ComponentProps<typeof Template>["meta"] = {
  title: entry.data.title,
  description: entry.data.description,
  article: {
    authors: ["pk"],
    tags: entry.data.tags,
    publishedTime: entry.data.created.toISOString(),
    modifiedTime: entry.data.updated.toISOString(),
  },
  ogImage: new URL(`/journal/${entry.id}.png`, Astro.url),
};

const structuredData: ComponentProps<typeof Template>["structuredData"] = {
  description: entry.data.description,
};
---

<Template meta={metadata} structuredData={structuredData}>
  <article>
    <Content/>
  </article>

  <br>

  <Separator/>

  <ContentProperties
    created={entry.data.created}
    updated={entry.data.updated}
    tags={entry.data.tags}
  />
</Template>
